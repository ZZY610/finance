# 金融产品估值定价

# 金融产品与衍生品定价模型详解

## 1. 金融衍生品定价

金融衍生品，其价值源于一种或多种基础资产（如股票、债券、商品、利率或指数）的表现。与基础资产不同，衍生品本身没有内在价值，其价值完全取决于标的资产的价格变动。因此，衍生品定价的核心在于构建一个数学模型，该模型能够精确地描述标的资产价格的随机过程，并在此基础上，通过无套利（No-Arbitrage）或风险中性（Risk-Neutral）等经济学原理，推导出衍生品的公允价值。这些模型不仅为市场交易提供定价基准，也是风险管理和套期保值策略的基础。

### 1.1 期权定价模型

期权是一种赋予其持有者在特定日期（到期日）或之前以特定价格（执行价格）买入或卖出某项资产的权利，而非义务的合约。期权定价是金融工程领域最核心和最复杂的课题之一。其定价模型的发展，特别是布莱克-斯科尔斯-默顿（Black-Scholes-Merton, BSM）模型的提出，被认为是现代金融学的重大突破。这些模型旨在为期权确定一个公允的理论价格，该价格能够反映所有影响其价值的因素，包括标的资产价格、执行价格、到期时间、无风险利率以及标的资产价格的波动性。

#### 1.1.1 Black-Scholes-Merton (B-S-M) 模型

Black-Scholes-Merton (B-S-M) 模型是期权定价领域最著名和应用最广泛的模型。它为欧式期权（只能在到期日行权）提供了一个封闭形式的解析解。该模型的核心思想是基于无套利定价原理，通过构建一个由股票和无风险资产组成的动态对冲投资组合，该组合能够完美复制期权的未来现金流。由于复制组合和期权在未来所有可能状态下的价值都相同，根据无套利原则，它们在当下的价值也必须相等。这个逻辑推导出了一个偏微分方程，其解即为期权的定价公式 。该模型基于一系列关键假设，包括：标的资产价格服从几何布朗运动（即对数正态分布），市场无摩擦（无交易成本、无税收），无风险利率和标的资产波动率在期权有效期内为常数，以及市场不存在无风险套利机会。

对于不支付股息的欧式看涨期权，B-S-M 定价公式如下 ：

$$
C = S_0 \Phi(d_1) - K e^{-rT} \Phi(d_2)
$$

其中：
-   $C$ 是看涨期权的理论价格。
-   $S_0$ 是标的资产在当前的现货价格。
-   $K$ 是期权的执行价格。
-   $T$ 是期权的到期时间（以年为单位）。
-   $r$ 是无风险利率（连续复利）。
-   $\sigma$ 是标的资产价格的波动率（标准差）。
-   $\Phi(\cdot)$ 是标准正态分布的累积分布函数。
-   $d_1$ 和 $d_2$ 是中间变量，计算公式为：

$$
d_1 = \frac{\ln(S_0 / K) + (r + \sigma^2 / 2)T}{\sigma \sqrt{T}}
$$

$$
d_2 = d_1 - \sigma \sqrt{T}
$$

对于支付连续股息收益率 $q$ 的标的资产，B-S-M 公式需要进行调整。调整后的看涨期权定价公式为 ：

$$
C = S_0 e^{-qT} \Phi(d_1) - K e^{-rT} \Phi(d_2)
$$

其中，$d_1$ 的计算公式也相应调整为：

$$
d_1 = \frac{\ln(S_0 / K) + (r - q + \sigma^2 / 2)T}{\sigma \sqrt{T}}
$$

而 $d_2$ 的计算方式不变。这个调整反映了股息支付会降低持有标的资产的成本，从而影响期权的价值。B-S-M 模型虽然强大，但其严格的假设条件也限制了其在某些现实市场情况下的适用性，例如，它无法处理美式期权（可在到期前任何时间行权）以及波动率不为常数的情况。因此，后续发展出了许多修正和替代的定价模型。

#### 1.1.2 二叉树模型 (Binomial Tree Model)

二叉树模型是由Cox, Ross和Rubinstein于1979年提出的，是一种离散时间的期权定价数值方法。与B-S-M模型的连续时间假设不同，它将期权的整个有效期划分为若干个相等的小时间段，并假设在每个时间段内，标的资产的价格只有两种可能的变动方向：上升（up）或下降（down） 。通过从到期日向前逐步回溯，可以计算出期权在当前时刻的理论价格。该模型直观易懂，且能够处理美式期权（可在到期前任何时间行权）等B-S-M模型难以直接定价的复杂期权 。

**基本原理与构建**

二叉树模型的核心思想是构建一个无风险的对冲组合，并利用无套利原理进行定价。在每个节点上，通过买入或卖出一定数量的标的资产来对冲持有期权的风险，使得该组合在下一个时间段的收益是确定的（无风险的）。这个无风险组合的收益率必须等于无风险利率，否则就存在套利机会。

构建二叉树模型的关键步骤如下：
1.  **划分时间步长**：将期权有效期 `T` 划分为 `N` 个长度为 `Δt = T/N` 的小时间段。
2.  **确定价格变动参数**：设定每个时间步长内标的资产价格上升的幅度 `u` 和下降的幅度 `d`。通常，这些参数与标的资产的波动率 `σ` 和时间步长 `Δt` 相关。一个常见的设定是：
    $$
    u = e^{\sigma \sqrt{\Delta t}}
    $$
    $$
    d = e^{-\sigma \sqrt{\Delta t}} = \frac{1}{u}
    $$
3.  **计算风险中性概率**：在风险中性世界中，标的资产价格上涨的概率 `p` 和下跌的概率 `1-p` 可以通过无套利条件推导出来。这个概率被称为风险中性概率（Risk-Neutral Probability），其计算公式为 ：
    $$
    p = \frac{e^{(r-q)\Delta t} - d}{u - d}
    $$
    其中 `r` 是无风险利率，`q` 是连续股息率。

**定价公式与计算示例**

期权的价格是通过从二叉树的末端（到期日）向前递推计算得出的。

**步骤1：计算到期日期权的价值**
在到期日 `T`，期权的价值是确定的。对于看涨期权，其价值为 `max(S_T - K, 0)`；对于看跌期权，其价值为 `max(K - S_T, 0)`。其中 `S_T` 是到期日标的资产的可能价格。

**步骤2：向前递推计算每个节点的期权价值**
对于任意一个节点 `(i, j)`（表示在第 `i` 个时间步，第 `j` 个价格节点），其期权价值 `V(i, j)` 可以通过其后续两个节点 `(i+1, j+1)`（价格上涨）和 `(i+1, j)`（价格下跌）的价值 `V_up` 和 `V_down` 计算得出。根据无套利原理，该节点的价值等于其后续节点价值的期望以无风险利率折现到当前时刻 ：
$$
V(i, j) = e^{-r \Delta t} [p \cdot V_{up} + (1-p) \cdot V_{down}]
$$
对于美式期权，在每个节点还需要比较“立即行权”和“继续持有”的价值，并取其中的较大者：
$$
V_{American}(i, j) = \max(\text{Intrinsic Value}, e^{-r \Delta t} [p \cdot V_{up} + (1-p) \cdot V_{down}])
$$
其中，内在价值（Intrinsic Value）对于看涨期权是 `S(i,j) - K`，对于看跌期权是 `K - S(i,j)`。

**计算示例**

我们使用与B-S-M模型示例相似的参数，但采用一个两期二叉树模型来简化计算：
-   `S_0` = 100元, `K` = 105元, `T` = 1年, `r` = 5%, `σ` = 20%, `q` = 0%
-   将1年分为2期，所以 `Δt` = 0.5年

**步骤1：计算 `u`, `d`, 和 `p`**
$$
u = e^{0.20 \times \sqrt{0.5}} = e^{0.1414} \approx 1.1519
$$
$$
d = e^{-0.20 \times \sqrt{0.5}} \approx 0.8680
$$
$$
p = \frac{e^{0.05 \times 0.5} - 0.8680}{1.1519 - 0.8680} = \frac{1.0253 - 0.8680}{0.2839} \approx 0.5542
$$

**步骤2：构建标的资产价格的二叉树**
-   **t=0 (现在)**: `S_0` = 100
-   **t=1 (6个月后)**:
    -   上涨节点: `S_u` = 100 * 1.1519 = 115.19
    -   下跌节点: `S_d` = 100 * 0.8680 = 86.80
-   **t=2 (1年后，到期日)**:
    -   上涨-上涨节点: `S_uu` = 115.19 * 1.1519 ≈ 132.69
    -   上涨-下跌节点: `S_ud` = 115.19 * 0.8680 ≈ 100.00
    -   下跌-下跌节点: `S_dd` = 86.80 * 0.8680 ≈ 75.34

**步骤3：计算到期日（t=2）期权的价值**
-   `C_uu` = max(132.69 - 105, 0) = 27.69
-   `C_ud` = max(100.00 - 105, 0) = 0
-   `C_dd` = max(75.34 - 105, 0) = 0

**步骤4：向前递推计算**
-   **在 t=1 的上涨节点 `C_u`**:
    $$
    C_u = e^{-0.05 \times 0.5} [p \cdot C_{uu} + (1-p) \cdot C_{ud}] = e^{-0.025} [0.5542 \times 27.69 + 0.4458 \times 0] \approx 0.9753 \times 15.35 \approx 14.97
    $$
-   **在 t=1 的下跌节点 `C_d`**:
    $$
    C_d = e^{-0.025} [p \cdot C_{ud} + (1-p) \cdot C_{dd}] = e^{-0.025} [0.5542 \times 0 + 0.4458 \times 0] = 0
    $$
-   **在 t=0 的当前期权价格 `C_0`**:
    $$
    C_0 = e^{-0.025} [p \cdot C_u + (1-p) \cdot C_d] = e^{-0.025} [0.5542 \times 14.97 + 0.4458 \times 0] \approx 0.9753 \times 8.30 \approx 8.09 \text{元}
    $$
通过两期二叉树模型计算出的期权价格约为8.09元。随着划分的时间步长 `N` 增加，二叉树模型的计算结果会收敛到B-S-M模型的解析解 。

#### 1.1.3 其他期权定价模型

除了经典的B-S-M模型和二叉树模型，学术界和业界还发展出多种更复杂的模型，以克服经典模型的局限性，更精确地拟合市场数据。

**随机波动率模型 (Stochastic Volatility Models)**

B-S-M模型假设波动率 `σ` 是一个常数，但实证研究表明，波动率本身也是随时间变化的，并且与资产价格存在负相关关系（即“杠杆效应”）。随机波动率模型将波动率也视为一个随机过程，从而能够更好地解释市场中观察到的“波动率微笑”或“波动率倾斜”现象 。

-   **Heston模型 (1993)** ：这是最著名且应用最广泛的随机波动率模型之一。它假设资产价格的方差 `v` (即 `σ^2`) 遵循一个均值回归的平方根过程（Cox-Ingersoll-Ross过程），并且资产价格与方差的变动可以存在相关性 `ρ`。Heston模型的优势在于它能够推导出欧式期权的半闭式解（semi-closed-form solution），这使得模型校准（即根据市场价格反推模型参数）在计算上非常高效 。
    Heston模型假设的随机过程为 ：
    $$
    dS_t = \mu S_t dt + \sqrt{v_t} S_t dW_t^S
    $$
    $$
    dv_t = \kappa(\theta - v_t)dt + \gamma \sqrt{v_t} dW_t^v
    $$
    其中，`v_t` 是瞬时方差，`κ` 是均值回归速度，`θ` 是长期平均方差，`γ` 是方差的波动率，`dW_t^S` 和 `dW_t^v` 是两个相关的布朗运动，其相关系数为 `ρ`。

-   **SABR模型**：该模型在利率和外汇衍生品市场中应用广泛。它同样假设波动率是随机的，但其随机过程的形式与Heston模型不同，并且可以得到一个解析的近似解，计算效率非常高 。

**跳跃扩散模型 (Jump-Diffusion Models)**

B-S-M模型假设资产价格是连续变动的，无法解释市场中偶尔出现的突然、大幅的价格跳跃（如公司发布重大新闻、市场崩盘等）。跳跃扩散模型在标准的几何布朗运动基础上，增加了一个跳跃过程（通常用泊松过程描述），以模拟这些不连续的价格变动 。

-   **Merton跳跃扩散模型 (1976)** ：该模型由Robert Merton提出，它将资产价格的变化分解为两部分：一个连续的扩散部分（由布朗运动描述）和一个不连续的跳跃部分（由泊松过程描述）。每次跳跃的幅度通常被假设为服从对数正态分布。该模型能够产生比B-S-M模型更厚的尾部，从而更好地拟合深度虚值期权的价格 。
    其资产价格过程为 ：
    $$
    dS_t = \mu S_t dt + \sigma S_t dW_t + S_{t^-}(e^{Y_t} - 1)dN_t
    $$
    其中，`N_t` 是强度为 `λ` 的泊松过程，`Y_t` 是跳跃幅度，通常 `Y_t ~ N(γ, δ^2)`。

**其他数值方法**

对于没有解析解的复杂期权（如美式期权、障碍期权、亚式期权等），必须依赖数值方法进行定价。

-   **蒙特卡洛模拟 (Monte Carlo Simulation)** ：该方法通过计算机模拟标的资产价格的大量可能路径，然后计算每条路径下期权的到期收益，并将这些收益的平均值用无风险利率折现到当前，从而得到期权的估计价格。蒙特卡洛模拟非常灵活，可以处理路径依赖型期权和高维问题，但计算成本较高，收敛速度较慢 。

-   **有限差分法 (Finite Difference Method)** ：该方法将期权定价所满足的偏微分方程（如Black-Scholes方程）进行离散化，通过在时间和价格维度上建立网格，将微分方程转化为差分方程组，然后通过迭代求解得到期权在各个网格点的价值。该方法适用于美式期权等具有提前行权特征的衍生品定价 。

### 1.2 期货与远期合约定价

期货和远期合约都是约定在未来某一特定日期以特定价格买卖某种资产的协议。它们的主要区别在于，期货是标准化的交易所交易产品，实行每日无负债结算（逐日盯市），而远期合约是非标准化的场外交易产品，通常在到期日一次性结算。尽管存在这些差异，它们的定价原理是相同的，都基于无套利原则和持有成本理论。

#### 1.2.1 持有成本模型 (Cost-of-Carry Model)

持有成本模型是期货和远期合约定价的基础。该模型指出，一个公平的远期价格（或期货价格）应该等于标的资产的即期价格加上从现在到交割日期间的净持有成本。净持有成本包括融资利息、仓储费用等支出，同时扣除标的资产在持有期间可能产生的收益（如股息、利息） 。这个模型的核心思想是，投资者可以通过在即期市场买入资产并持有至到期日来复制一个远期合约的多头头寸，因此，远期合约的价格必须与这个复制策略的成本相等，否则就会出现套利机会。

持有成本模型的基本定价公式为：
$F = S_0 + C - Y$
其中：
- $F$: 远期或期货价格。
- $S_0$: 标的资产的即期价格。
- $C$: 持有成本（如融资利息、仓储费等）。
- $Y$: 持有期间产生的收益（如股息、利息等）。

对于金融资产，持有成本通常用无风险利率来表示，而收益则用股息率或利息率来表示。因此，公式可以进一步细化为：
$F = S_0 e^{(r - q)T}$
其中：
- $r$: 无风险利率（连续复利）。
- $q$: 标的资产的连续收益率（如股息率）。
- $T$: 到期时间（以年为单位）。

这个公式表明，当收益率 $q$ 大于无风险利率 $r$ 时，远期价格会低于即期价格，这种情况称为“现货溢价”（Backwardation）；反之，当 $r > q$ 时，远期价格高于即期价格，称为“期货溢价”（Contango）。

**股指期货定价示例：**
假设某股票指数当前点位为 $S_0 = 3000$ 点，无风险利率为 $r = 5\%$，该指数的年化股息率为 $q = 2\%$。一份3个月后（$T=0.25$年）到期的股指期货合约的理论价格是多少？

根据持有成本模型：
$F = 3000 \times e^{(0.05 - 0.02) \times 0.25} = 3000 \times e^{0.03 \times 0.25} = 3000 \times e^{0.0075} \approx 3000 \times 1.0075 = 3022.5$ 点

因此，这份股指期货合约的理论价格应为3022.5点。如果市场价格偏离此价格，套利者就会介入，通过买入低估资产、卖出高估资产来获取无风险利润，从而推动价格回归理论值。

#### 1.2.2 外汇远期合约定价：利率平价理论

外汇远期合约的定价是持有成本模型的一个特例，其核心是利率平价理论（Interest Rate Parity, IRP）。该理论认为，两种货币之间的远期汇率与即期汇率的差异，应该等于两国利率的差异。如果这一关系不成立，投资者就可以通过在即期和远期市场进行套利操作来获取无风险利润 。

根据利率平价理论，外汇远期汇率的定价公式为：
$F = S_0 \times \frac{1 + r_d \times T}{1 + r_f \times T}$ （离散复利）
或
$F = S_0 e^{(r_d - r_f)T}$ （连续复利）

其中：
- $F$: 远期汇率（以本币/外币表示）。
- $S_0$: 即期汇率（以本币/外币表示）。
- $r_d$: 本国货币的无风险利率。
- $r_f$: 外国货币的无风险利率。
- $T$: 到期时间（以年为单位）。

这个公式的逻辑是，投资者可以有两种选择：一是在本国投资，获得本币的无风险收益；二是将本币兑换成外币，在外国投资获得外币的无风险收益，同时通过签订远期合约锁定未来将外币兑换回本币的汇率。在均衡状态下，这两种投资策略的最终本币收益应该相等，否则就存在套利机会。

**外汇远期定价示例：**
假设当前美元兑人民币的即期汇率为 $S_0 = 7.20$ CNY/USD。中国的3个月期无风险年利率为 $r_d = 2.5\%$，美国的3个月期无风险年利率为 $r_f = 4.5\%$。一份3个月后到期的美元兑人民币远期合约的理论价格是多少？

使用连续复利公式：
$F = 7.20 \times e^{(0.025 - 0.045) \times 0.25} = 7.20 \times e^{-0.02 \times 0.25} = 7.20 \times e^{-0.005} \approx 7.20 \times 0.9950 = 7.164$ CNY/USD

因此，这份3个月期的美元兑人民币远期合约的理论价格应为7.164元。这个价格低于即期汇率，反映了美国利率高于中国利率的情况。如果远期汇率高于此值，套利者可以借入美元，兑换成人民币并投资，同时卖出远期美元合约，从而锁定无风险利润。

### 1.3 利率互换定价

利率互换（Interest Rate Swap, IRS）是场外交易（OTC）市场中最重要的金融衍生品之一，其核心功能在于允许交易双方将一种形式的利息支付义务（如固定利率）转换为另一种（如浮动利率），从而管理利率风险或进行投机 。最常见的“普通香草型”（Plain Vanilla）利率互换，是指一方同意在未来一系列特定日期，按名义本金（Notional Principal）的固定比例支付利息，以换取另一方按浮动利率（如SOFR、LIBOR等）支付的利息 。由于名义本金在交易双方之间并不实际交换，互换的价值完全体现在未来一系列利息支付的净差额上。因此，其定价和估值的核心在于确定一个公平的固定利率，使得在合约初始时，双方未来现金流的现值相等，从而使合约的初始价值为零 。

#### 1.3.1 定价原理：固定腿与浮动腿现值相等

利率互换定价的根本原则是“无套利”（No-Arbitrage），即在合约签订时，其公允价值应为零。这意味着交易双方中，任何一方都不应在初始时刻获得无成本的利益。为了实现这一点，互换中固定利率支付的现金流（称为“固定腿”，Fixed Leg）的现值（Present Value, PV），必须等于浮动利率支付的现金流（称为“浮动腿”，Floating Leg）的现值 。这个等式是求解互换中未知固定利率（即“互换利率”）的基础。具体而言，定价过程可以分解为两个主要部分：首先，根据当前市场上的利率期限结构（如即期利率曲线或远期利率曲线），计算出未来每一期浮动利率支付的预期值，并将其折现到当前时点，得到浮动腿的总现值（PV<sub>Floating</sub>）。其次，设定一个未知的固定利率R，计算出未来每一期固定利息支付的现值，得到固定腿的总现值（PV<sub>Fixed</sub>）。通过求解方程 PV<sub>Fixed</sub> = PV<sub>Floating</sub>，即可得到使得互换初始价值为零的公平固定利率R 。

这个原理的直观理解是，浮动利率的支付额是基于未来市场利率的预期，而固定利率的支付额是确定的。因此，固定利率的设定必须精确地反映市场对未来浮动利率走势的集体预期。如果固定利率设定得过高，支付固定利率的一方将处于不利地位，互换对其而言将具有负的初始价值；反之，如果固定利率过低，则对收取固定利率的一方不利。因此，一个公平的互换利率必须精确地平衡双方的预期支付，使得在合约开始时，双方的权利和义务在价值上是相等的 。这种平衡状态确保了市场的公平性和有效性，是衍生品定价理论的基石。

#### 1.3.2 互换利率 (Swap Rate) 的计算

互换利率（Swap Rate），即利率互换中的固定利率，是通过使固定腿现值等于浮动腿现值来确定的。其计算依赖于对未来浮动利率的预测（通常使用远期利率）和用于折现未来现金流的贴现因子（Discount Factors），这些因子均源自当前的利率期限结构（Yield Curve）。

##### 1.3.2.1 基本定价公式

互换利率的计算核心是求解以下等式：

PV<sub>Fixed</sub> = PV<sub>Floating</sub>

其中，固定腿的现值（PV<sub>Fixed</sub>）和浮动腿的现值（PV<sub>Floating</sub>）分别由以下公式计算 ：

**固定腿现值 (PV<sub>Fixed</sub>):**
$$
PV_{Fixed} = N \sum_{i=1}^{n} \frac{R \cdot \tau_i}{(1 + r_i)^{t_i}}
$$
或者更一般地，使用贴现因子（DF<sub>i</sub>）表示：
$$
PV_{Fixed} = N \cdot R \sum_{i=1}^{n} \tau_i \cdot DF_i
$$

**浮动腿现值 (PV<sub>Floating</sub>):**
$$
PV_{Floating} = N \sum_{j=1}^{m} \frac{F_j \cdot \tau_j}{(1 + r_j)^{t_j}}
$$
同样，使用贴现因子和远期利率（Fwd<sub>j</sub>）表示：
$$
PV_{Floating} = N \sum_{j=1}^{m} Fwd_j \cdot \tau_j \cdot DF_j
$$

**求解互换利率 (R):**
通过令 PV<sub>Fixed</sub> = PV<sub>Floating</sub>，可以解出互换利率 R：
$$
R = \frac{\sum_{j=1}^{m} Fwd_j \cdot \tau_j \cdot DF_j}{\sum_{i=1}^{n} \tau_i \cdot DF_i}
$$
这个公式表明，互换利率本质上是浮动腿现金流的加权平均，权重为各期的时间分数和贴现因子 。

**公式参数说明:**
*   **N**: 名义本金（Notional Amount），是计算利息支付的基础，但本身不交换 。
*   **R**: 待求解的互换利率（Swap Rate），即固定利率 。
*   **τ (tau)**: 日计数分数（Day Count Fraction），表示一个计息期内实际天数与全年天数的比率，用于精确计算利息。例如，ACT/360 或 30/360 。
*   **r**: 贴现率（Discount Rate），通常使用与现金流期限相匹配的无风险利率，如国债收益率或OIS（隔夜指数互换）利率 。
*   **t**: 距离支付日的时间（Time to Payment），以年为单位 。
*   **DF (Discount Factor)**: 贴现因子，表示未来某一时间点收到的1单位货币在当前的价值，DF = 1 / (1 + r * t) 或从利率期限结构曲线直接得出 。
*   **Fwd (Forward Rate)**: 远期利率，指从未来某一时间点开始的特定期限的利率，是市场对未来利率的预期，可从即期利率曲线推导得出 。

##### 1.3.2.2 计算示例

假设我们有一个1年期的利率互换，名义本金为1亿美元，每季度支付一次。我们需要根据当前的SOFR即期利率来确定公平的互换利率。

**第一步：获取市场数据并计算贴现因子和远期利率**

假设当前的USD SOFR即期利率如下表所示 ：

| 期限 (Term) | 即期利率 (Spot Rate) |
| :--- | :--- |
| 3个月 | 5.33% |
| 6个月 | 5.28% |
| 9个月 | 5.20% |
| 12个月 | 5.15% |

我们使用公式 DF = 1 / (1 + r * t/360) 计算各期的贴现因子（假设使用ACT/360日计数惯例）：

| 期限 (t) | 即期利率 (r) | 贴现因子 (DF) 计算 | 贴现因子 (DF) |
| :--- | :--- | :--- | :--- |
| 3个月 (90天) | 5.33% | 1 / (1 + 0.0533 * 90/360) | 0.9868 |
| 6个月 (180天) | 5.28% | 1 / (1 + 0.0528 * 180/360) | 0.9743 |
| 9个月 (270天) | 5.20% | 1 / (1 + 0.0520 * 270/360) | 0.9621 |
| 12个月 (360天) | 5.15% | 1 / (1 + 0.0515 * 360/360) | 0.9510 |

接下来，我们计算各季度的远期利率。远期利率是连接两个即期利率的隐含利率。例如，3个月后的3个月远期利率（f<sub>3m,6m</sub>）可以通过以下公式计算：
(1 + r<sub>6m</sub> * 180/360) = (1 + r<sub>3m</sub> * 90/360) * (1 + f<sub>3m,6m</sub> * 90/360)
f<sub>3m,6m</sub> = [ (1 + 0.0528 * 0.5) / (1 + 0.0533 * 0.25) - 1 ] / 0.25 ≈ 5.23%

类似地，我们可以计算出所有季度的远期利率：

| 季度 | 远期利率 (Fwd) |
| :--- | :--- |
| Q1 (0-3个月) | 5.33% (即期利率) |
| Q2 (3-6个月) | 5.23% |
| Q3 (6-9个月) | 5.04% |
| Q4 (9-12个月) | 4.95% |

**第二步：计算浮动腿和固定腿的现值**

假设日计数分数 τ 对于每个季度都是 90/360 = 0.25。

**浮动腿现值 (PV<sub>Floating</sub>) 计算:**
PV<sub>Floating</sub> = N * Σ (Fwd<sub>j</sub> * τ * DF<sub>j</sub>)
= 100,000,000 * [ (0.0533 * 0.25 * 0.9868) + (0.0523 * 0.25 * 0.9743) + (0.0504 * 0.25 * 0.9621) + (0.0495 * 0.25 * 0.9510) ]
= 100,000,000 * [ 0.01315 + 0.01274 + 0.01212 + 0.01177 ]
= 100,000,000 * 0.04978
= 4,978,000 美元

**固定腿现值 (PV<sub>Fixed</sub>) 计算:**
PV<sub>Fixed</sub> = N * R * Σ (τ * DF<sub>i</sub>)
= 100,000,000 * R * [ (0.25 * 0.9868) + (0.25 * 0.9743) + (0.25 * 0.9621) + (0.25 * 0.9510) ]
= 100,000,000 * R * [ 0.2467 + 0.2436 + 0.2405 + 0.2378 ]
= 100,000,000 * R * 0.9686
= 96,860,000 * R

**第三步：求解互换利率 (R)**

令 PV<sub>Fixed</sub> = PV<sub>Floating</sub>:
96,860,000 * R = 4,978,000
R = 4,978,000 / 96,860,000 ≈ 0.05139 或 **5.139%**

因此，这个1年期、每季度支付的利率互换的公平互换利率约为5.139%。这个利率确保了在合约开始时，固定腿和浮动腿的现值相等，合约价值为零 。

#### 1.3.3 利率互换的估值

利率互换的估值（Valuation）是指在合约签订后的任意时间点，计算该互换合约对其中一方的价值。与定价（Pricing）不同，定价是在合约初始时确定公平的互换利率，而估值则是在合约存续期内，根据市场利率的变化，评估合约的当前市场价值。这个价值可能为正（资产），也可能为负（负债） 。

##### 1.3.3.1 估值原理

利率互换的估值原理是计算未来所有剩余现金流的净现值（Net Present Value, NPV）。对于合约的一方（例如，支付固定利率、收取浮动利率的一方），其价值等于其未来将要收取的浮动利息的现值，减去其未来将要支付的固定利息的现值 。

**估值公式:**
对于收取固定利率、支付浮动利率的一方，互换的价值 (V) 为：
V = PV<sub>Fixed</sub> - PV<sub>Floating</sub>

对于支付固定利率、收取浮动利率的一方，互换的价值 (V) 为：
V = PV<sub>Floating</sub> - PV<sub>Fixed</sub>

其中，PV<sub>Fixed</sub> 和 PV<sub>Floating</sub> 的计算方法与定价时相同，但使用的是估值时点的最新市场数据（即当前的利率期限结构）来计算贴现因子和远期利率。由于市场利率不断变化，浮动腿的现值和固定腿的现值也会随之变化，从而导致互换的价值发生波动 。

##### 1.3.3.2 估值示例

假设在上述互换合约签订后3个月，市场利率发生了变化。此时，我们需要对剩余的9个月合约进行估值。名义本金仍为1亿美元，固定利率为之前确定的5.139%。

**第一步：获取新的市场数据并计算新的贴现因子和远期利率**

假设3个月后，新的USD SOFR即期利率如下：

| 期限 (Term) | 即期利率 (Spot Rate) |
| :--- | :--- |
| 3个月 | 5.50% |
| 6个月 | 5.60% |
| 9个月 | 5.70% |

计算新的贴现因子（从当前时点开始计算）：

| 期限 (t) | 即期利率 (r) | 贴现因子 (DF) |
| :--- | :--- | :--- |
| 3个月 (90天) | 5.50% | 0.9864 |
| 6个月 (180天) | 5.60% | 0.9728 |
| 9个月 (270天) | 5.70% | 0.9589 |

计算新的远期利率（从当前时点开始计算）：

| 季度 | 远期利率 (Fwd) |
| :--- | :--- |
| Q1 (当前-3个月) | 5.50% |
| Q2 (3-6个月) | 5.70% |
| Q3 (6-9个月) | 5.90% |

**第二步：计算剩余现金流的现值**

**剩余固定腿现值 (PV<sub>Fixed</sub>):**
PV<sub>Fixed</sub> = N * R * Σ (τ * DF<sub>i</sub>)
= 100,000,000 * 0.05139 * [ (0.25 * 0.9864) + (0.25 * 0.9728) + (0.25 * 0.9589) ]
= 100,000,000 * 0.05139 * 0.7295
= 3,749,851 美元

**剩余浮动腿现值 (PV<sub>Floating</sub>):**
PV<sub>Floating</sub> = N * Σ (Fwd<sub>j</sub> * τ * DF<sub>j</sub>)
= 100,000,000 * [ (0.0550 * 0.25 * 0.9864) + (0.0570 * 0.25 * 0.9728) + (0.0590 * 0.25 * 0.9589) ]
= 100,000,000 * [ 0.01356 + 0.01386 + 0.01414 ]
= 100,000,000 * 0.04156
= 4,156,000 美元

**第三步：计算互换的当前价值**

对于支付固定利率、收取浮动利率的一方，其价值为：
V = PV<sub>Floating</sub> - PV<sub>Fixed</sub>
V = 4,156,000 - 3,749,851 = **406,149 美元**

由于市场利率上升，浮动利率支付的预期值增加，超过了固定利率支付的现值，因此该互换对支付固定利率的一方来说，现在是一个价值为406,149美元的资产。相应地，对另一方来说，这是一个等额的负债 。

##### 1.3.3.3 考虑信用风险（CVA/DVA）

在实际操作中，利率互换的估值还需要考虑交易对手的信用风险，即对手方违约的可能性。这种调整被称为信用估值调整（Credit Valuation Adjustment, CVA）。如果互换对某一方是资产（即价值为正），那么该方需要考虑对手方违约的风险，这会降低互换的价值。反之，如果互换是负债（价值为负），该方自身的信用状况也会影响其价值，这被称为债务估值调整（Debt Valuation Adjustment, DVA）。根据会计准则（如GAAP），公允价值计量必须包含非履行风险的影响 。

**考虑信用风险后的估值公式:**
公允价值 = 无风险价值 - CVA + DVA

其中：
*   **CVA**: 考虑了对手方违约概率和违约损失率（Loss Given Default, LGD）后，对资产价值的减项。
*   **DVA**: 考虑了自身违约概率和违约损失率后，对负债价值的减项（即增加了负债的价值，因为自身违约的可能性降低了需要偿付的金额）。

这种调整使得互换的估值更加精确和审慎，反映了真实世界中交易对手信用状况对合约价值的影响 。

### 1.4 回购协议定价

回购协议（Repurchase Agreement, Repo）是一种以证券为抵押的短期资金融通工具，其定价核心在于确定回购利率（Repo Rate），该利率反映了资金融出方因提供资金而要求的回报。回购交易的定价不仅涉及利率的计算，还与抵押品的价值、交易期限、市场供求关系以及交易对手的信用风险等多种因素紧密相关。从本质上讲，回购利率是一种有担保的借款利率，其定价机制旨在平衡资金融入方和融出方的利益，同时反映市场的整体流动性状况和风险水平 。在实际操作中，回购协议的定价通常由交易双方参照市场基准利率（如银行间同业拆借利率）协商确定，并根据具体交易条件进行调整 。

#### 1.4.1 定价原理与公式

回购协议的定价原理基于资金的时间价值和风险溢价。资金融出方在交易开始时支付一笔资金，并在未来某个约定日期收回本金和利息。因此，回购价格（即未来购回价格）的确定，本质上是对初始交易金额在约定期限内按特定利率计息的结果。这个特定利率就是回购利率，它通常由无风险利率和针对交易特定风险的溢价构成 。无风险利率一般参考政府债券利率或央行政策利率，而风险溢价则涵盖了交易对手的信用风险、抵押品的流动性风险以及市场利率波动风险等。

回购协议的基本定价公式可以表示为：

**回购价格 = 初始交易金额 × (1 + 回购利率 × 回购期限 / 计息基准)**

其中：
- **初始交易金额**：也称为本金，是资金融出方在交易开始时支付的金额。
- **回购利率**：交易双方约定的年化利率。
- **回购期限**：从交易开始到结束的时长，通常以天为单位。
- **计息基准**：根据市场惯例确定，例如，中国市场通常使用365天作为计息基准。

这个公式清晰地展示了回购价格与回购利率和期限之间的线性关系。回购利率是定价的核心，其高低直接决定了资金融入方的融资成本和资金融出方的投资收益。在实际应用中，回购利率的确定是一个复杂的过程，需要综合考虑多种市场因素和交易细节。

#### 1.4.2 计算示例

为了更好地理解回购协议的定价过程，我们来看一个具体的计算示例。假设某金融机构A需要短期融资，与金融机构B达成一笔回购协议。A将面值为1亿元的国债出售给B，并约定在三个月后（90天后）以约定价格购回。双方商定的回购利率为2.5%（年化）。

**第一步：确定初始交易金额**
初始交易金额通常是抵押品的市场价值乘以一个折扣率（Haircut）。折扣率是为了防范抵押品价值波动的风险。假设该国债的市场价值为1亿元，折扣率为2%，则初始交易金额为：
初始交易金额 = 1亿元 × (1 - 2%) = 9800万元

**第二步：计算回购价格**
根据回购定价公式，我们可以计算出三个月后的回购价格。
- 初始交易金额 (P₀) = 9800万元
- 回购利率 (r) = 2.5% = 0.025
- 回购期限 (t) = 90天
- 计息基准 = 365天

回购价格 (P₁) = P₀ × (1 + r × t / 365)
P₁ = 9800 × (1 + 0.025 × 90 / 365)
P₁ = 9800 × (1 + 0.006164)
P₁ = 9800 × 1.006164
P₁ ≈ 9860.41万元

**第三步：分析交易双方的现金流**
- **资金融入方 (A) 的现金流**：
  - 期初：收到9800万元现金。
  - 期末：支付9860.41万元现金，收回价值1亿元的国债。
- **资金融出方 (B) 的现金流**：
  - 期初：支付9800万元现金，获得价值1亿元的国债作为抵押。
  - 期末：收到9860.41万元现金，返还抵押的国债。

在这个例子中，资金融出方B通过这笔交易获得了60.41万元的利息收入，其年化收益率为2.5%。这笔交易的融资成本对A而言是2.5%，对B而言，由于有国债作为抵押，其风险相对较低，因此获得的收益率也低于无担保的同业拆借利率。这个例子清晰地展示了回购协议定价的核心要素和计算过程，体现了其作为一种高效、低风险的短期融资工具的特点。

## 2. 基础金融产品定价

基础金融产品，如股票、债券、基金和存款，是金融市场的基石。它们的定价方法虽然各不相同，但核心思想都是基于未来现金流的贴现。投资者购买这些产品的目的是为了获得未来的收益，因此其当前价值等于未来所有预期收益的现值之和。这种贴现现金流（DCF）的方法是金融资产定价的通用框架。



### 2.4 存款定价

银行存款作为商业银行最核心、最基础的负债业务，其定价策略不仅直接关系到银行的资金成本和盈利能力，也深刻影响着整个金融体系的流动性和稳定性。存款定价的本质是银行在吸收存款（负债）与发放贷款（资产）之间进行的一场精密的博弈。银行需要支付一定的利息来吸引和留住客户的存款，形成其主要的资金来源，然后以更高的利率将这些资金贷出或进行投资，从中赚取利差。因此，存款定价的目标是在满足监管要求、控制流动性风险的前提下，以尽可能低的成本获取稳定且充足的资金 。随着利率市场化改革的深入，银行存款利率不再由央行统一规定，而是由市场供求关系、银行自身经营状况和竞争策略等多种因素共同决定，这使得存款定价成为一门复杂的管理艺术和科学 。

#### 2.4.1 定价原理：成本与利润导向

银行存款定价的核心原理是在成本与利润之间寻求最佳平衡点。银行需要确保其支付给存款人的利息（资金成本）低于其通过贷款和投资所获得的收益（资产回报），从而保证银行的持续盈利。这一原理衍生出多种具体的定价方法，主要可以分为成本导向、市场导向和客户导向三大类。

##### 2.4.1.1 成本导向定价法

成本导向定价法是一种以银行自身的成本结构为基础的定价策略。其核心思想是，存款利率的设定必须能够覆盖银行吸收和管理存款所发生的全部成本，并在此基础上实现一定的利润目标。这种方法强调内部成本核算，确保每一笔存款业务都能为银行带来正向贡献。

其中，**边际成本定价法**是成本导向法中的一个典型代表。该方法关注的是新增一单位存款所带来的总成本的增量，即边际成本。银行通过比较新增存款的边际成本与边际收益（即利用这笔存款进行贷款或投资所能产生的预期收益）来决定最优的存款利率和存款规模。当边际成本等于边际收益时，银行的利润总额达到最大化，此时的存款利率被认为是最佳选择 。

**边际成本计算公式**：
$边际成本 = 总成本变动额 = (新利率 \times 新利率下筹集的资金额) - (旧利率 \times 旧利率下筹集的资金额)$

**边际成本率计算公式**：
$边际成本率 = \frac{总成本变动额}{筹集的新增资金额} \times 100\%$

例如，一家银行将一年期定期存款利率从2.5%提高到3.0%，预计存款规模将从1亿元增加到1.2亿元。那么，新增2000万元存款所带来的总成本变动额为 (3.0% × 1.2亿) - (2.5% × 1亿) = 360万 - 250万 = 110万元。新增资金的边际成本率为 110万 / 2000万 = 5.5%。如果银行利用这笔资金进行贷款的预期收益率高于5.5%，那么提高利率就是有利可图的。这种方法有助于银行科学地确定存款规模，避免盲目扩张，并在利润下降时，寻找具有更低边际成本的新资金来源或更高边际收益的贷款项目 。

##### 2.4.1.2 市场导向定价法

市场导向定价法将关注点从银行内部成本转向外部市场环境，强调根据市场供求关系和竞争格局来制定存款利率。在利率市场化的背景下，这种方法变得尤为重要，因为它直接关系到银行的市场份额和竞争力。

**随行就市定价法**是市场导向法中最直接的一种。其基本原理是，银行参照同业（尤其是主要竞争对手）的平均价格水平或现行价格来设定自己的存款利率。这种方法的优点在于，所制定的价格容易被市场接受，能够避免因价格过高或过低而带来的客户流失或利润损失，从而保证银行获得一个相对适中的利润水平。对于许多中小型银行而言，由于缺乏强大的品牌议价能力，采用随行就市法是一种稳健且风险较低的策略 。

**市场渗透定价法**则是一种更为激进的策略。该方法的核心是通过提供远高于市场平均水平的存款利率，或收取远低于市场平均水平的服务费用，来吸引尽可能多的客户，迅速占领市场份额。银行希望通过由此带来的存款量的大幅增加，以及随之而来的相关贷款业务和其他交叉销售机会，来弥补较低的利润率。这种方法尤其适用于新进入市场的银行或希望在某一特定业务领域（如高净值客户）快速建立优势的银行。然而，其缺点也十分明显：首先，高利率会显著增加银行的资金成本，如果资产端收益无法同步提升，将严重侵蚀银行利润；其次，单纯依靠高利率吸引的客户忠诚度可能不高，一旦其他银行提供更高的利率，客户很容易流失 。

##### 2.4.1.3 客户导向与关系定价法

随着金融科技的发展和客户需求的日益多样化，以客户为中心的定价策略变得越来越重要。这种方法不再将存款视为同质化的产品，而是根据不同客户的价值、行为和需求来制定差异化的价格。

**客户分层定价模型**是客户导向定价的典型应用。银行利用大数据和机器学习技术，对客户进行精准画像和价值评估。例如，银行可能会发现高净值客户的资金稳定性远高于普通客户，其存款能够为银行提供更稳定、更长期的资金来源，从而降低了银行的流动性风险。因此，银行愿意为这部分客户提供更高的存款利率作为“溢价”，以锁定这部分优质负债。某股份制银行推出的“智能存款”产品，其年化利率较基准利率上浮45%，但要求客户保持日均资产50万元以上，这正是客户分层定价的体现。通过这种方式，银行不仅降低了吸储成本，还显著提升了客户留存率 。

**关系定价法**则更进一步，它综合考虑客户与银行之间的整体关系，而不仅仅是存款账户本身。银行会评估客户为银行带来的综合贡献，包括存款余额、贷款使用情况、信用卡消费、理财产品购买、支付结算等多种业务。对于那些与银行业务往来密切、综合贡献度高的“核心客户”，银行可能会提供更具吸引力的存款利率或减免部分账户管理费，以维护和深化客户关系。这种定价方式有助于银行从单一的产品销售转向全面的客户关系管理，提升客户的终身价值（LTV） 。

#### 2.4.2 目标利润定价法

目标利润定价法是一种更为综合和战略性的定价方法，它将银行的整体盈利目标分解到具体的负债产品上。其核心思想是，存款利率的设定不仅要覆盖所有相关成本，还必须为实现银行预设的利润目标做出贡献。这种方法通常涉及复杂的内部资金转移定价（FTP）机制。

在FTP体系下，银行的资产负债管理部门（ALM）扮演着“内部银行”的角色。它会从负债业务部门（如零售银行部）“购买”存款资金，并向资产业务部门（如公司银行部）“出售”资金。这个内部买卖的价格就是内部资金转移价格（FTP Rate）。负债业务部门的利润函数可以表示为：

$利润 (\pi_{D}) = (FTP Rate \times 负债总额) - (存款利率 \times 存款规模) - 其他成本$

为了实现利润最大化，银行需要找到一个最优的存款利率，使得存款规模的增长所带来的边际利润为零。在一个垄断竞争的市场模型中，银行对存款的定价公式可以表示为：

$r_d = \frac{\varepsilon_d}{\varepsilon_d - 1} \times (FTP Rate - c_d \times D)$

其中：
- $r_d$ 是银行提供给客户的存款利率。
- $\varepsilon_d$ 是存款的需求价格弹性，反映了存款量对利率变化的敏感程度。
- $FTP Rate$ 是内部资金转移价格，代表了银行使用这笔资金的机会成本。
- $c_d$ 是存款的管理成本系数。
- $D$ 是存款规模。

这个公式表明，银行提供的存款利率与内部资金成本正相关，即当银行使用资金的成本上升时，它会倾向于降低支付给存款人的利率以维持利差。同时，利率也与存款的需求弹性有关，对于需求弹性较低（客户对利率不敏感）的存款，银行可以设定更低的利率。这种模型为银行在复杂的市场环境中进行科学、精细化的存款定价提供了理论框架 。

#### 2.4.3 利息计算公式

尽管存款定价策略复杂多样，但最终落实到客户账户上的利息计算则相对标准化。利息的计算主要遵循以下基本公式：

**利息 = 本金 × 年利率 × 存款期限**

这里的各个要素需要根据具体的存款产品类型进行调整：
- **本金**：客户存入的初始资金。
- **年利率**：银行公布的、适用于该存款产品的年化利率。这个利率是银行根据前述各种定价策略确定的。
- **存款期限**：资金存入的时间长度。对于活期存款，通常按日计息；对于定期存款，则按约定的存期（如3个月、6个月、1年等）计算。

**具体应用示例：**
1.  **定期存款**：假设某客户存入10万元一年期定期存款，年利率为2.0%。到期时，客户可获得的利息为：100,000 × 2.0% × 1 = 2,000元。本息合计为102,000元。
2.  **活期存款**：活期存款通常采用日积数法计息。银行会每日计算账户余额，并将每日余额累加得到“累计日积数”。结息时，用累计日积数乘以日利率（年利率/360或365）来计算利息。例如，某活期账户年利率为0.3%，在一个季度（90天）内，其每日余额累计为900万元·天。则该季度的利息为：9,000,000 × (0.3% / 360) = 75元。

对于日益增多的**结构性存款**，其利息计算则更为复杂。结构性存款通常将大部分本金投资于固定收益产品（如债券），以保证本金安全，同时将小部分本金或利息投资于衍生品（如期权），以博取与挂钩标的（如黄金、汇率、股票指数）表现相关的高额潜在回报。其最终收益通常是一个区间，例如“保底1.5%，最高4.5%”，具体收益取决于挂钩标的在观察期内的表现。这类产品的定价需要运用复杂的金融工程模型，对其内嵌的衍生品部分进行精确定价，这超出了传统存款利息计算的范畴，属于金融衍生品定价的领域 。